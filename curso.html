<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Curso - ConectaFisio360</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
body{ margin:0; font-family:'Poppins',sans-serif; background:linear-gradient(135deg,#0f172a,#0b1120); color:white; }
.container{ padding:40px; max-width:1000px; margin:auto; }
h1{ color:#38bdf8; }
iframe{ width:100%; height:500px; border-radius:15px; margin-top:20px; border:0; }
.voltar{ display:inline-block; margin-bottom:20px; color:#38bdf8; text-decoration:none; }
.notice{ margin-top:20px; padding:18px; background:#111827; border-radius:10px; color:#cbd5e1; }
.btn{ display:inline-block; margin-top:12px; padding:10px 16px; background:#2563eb; color:#fff; border-radius:8px; text-decoration:none; }
</style>
</head>
<body>

<div class="container">
    <a href="cursos.html" class="voltar">‚Üê Voltar aos cursos</a>
    <a href="index.html" class="voltar" style="margin-left:20px;">üè† Home</a>

    <h1 id="titulo">Carregando...</h1>
    <p id="descricao"></p>

    <div id="player"></div>

    <div id="mensagem" class="notice" style="display:none;"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBceFT9nmk1XfVbYZEcZ3yUY1pstUblD3E",
  authDomain: "conectafisio-web.firebaseapp.com",
  databaseURL: "https://conectafisio-web-default-rtdb.firebaseio.com",
  projectId: "conectafisio-web",
  storageBucket: "conectafisio-web.firebasestorage.app",
  messagingSenderId: "816967061116",
  appId: "1:816967061116:web:0c716703027427827fc3f9"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

const params = new URLSearchParams(window.location.search);
const cursoId = params.get("id");
const userRole = localStorage.getItem('conectaRole') || 'normal';

if(!cursoId){
    document.getElementById("titulo").innerText = "Curso n√£o encontrado";
} else {
    const cursoRef = ref(database, "cursos/" + cursoId);
    get(cursoRef).then((snapshot)=>{
        if(snapshot.exists()){
            const curso = snapshot.val();
            document.getElementById("titulo").innerText = curso.titulo;
            document.getElementById("descricao").innerText = curso.descricao;

            const tipo = curso.tipo || 'gratis';

            if(tipo === 'premium' && userRole !== 'premium'){
                // bloqueado
                document.getElementById("player").innerHTML = "";
                const msg = document.getElementById("mensagem");
                msg.style.display = 'block';
                msg.innerHTML = `Este √© um conte√∫do <strong>Premium</strong>. Voc√™ tem a conta <strong>${userRole}</strong>.<br><br>
                                 Para liberar, fa√ßa upgrade: <a class="btn" href="checkout.html">Fazer upgrade</a>`;
            } else {
                // libera o player
                document.getElementById("player").innerHTML = `<iframe src="${curso.link}" allowfullscreen></iframe>`;
            }
        } else {
            document.getElementById("titulo").innerText = "Curso n√£o encontrado";
        }
    }).catch((err)=>{
        document.getElementById("titulo").innerText = "Erro ao carregar";
        console.error(err);
    });
}
</script>

</body>
</html>
