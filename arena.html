<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArenaFisio - RPG Cl√≠nico</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #0b1120;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden; /* Impede scroll para o jogo n√£o fugir */
        }

        /* CEN√ÅRIO DO JOGO */
        #game-container {
            position: relative;
            width: 100vw;
            height: 80vh;
            background: #1e293b;
            background-image: 
                linear-gradient(#334155 1px, transparent 1px),
                linear-gradient(90deg, #334155 1px, transparent 1px);
            background-size: 50px 50px; /* Cria um grid de ch√£o */
            border-bottom: 4px solid #38bdf8;
        }

        /* O JOGADOR */
        #player {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: #38bdf8;
            border-radius: 8px;
            border: 3px solid white;
            transition: all 0.1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 10;
        }

        /* O PACIENTE (NPC) */
        #patient {
            position: absolute;
            top: 200px;
            left: 500px;
            width: 45px;
            height: 45px;
            background-color: #fb7185;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px #fb7185;
        }

        /* BAL√ÉO DE INTERA√á√ÉO */
        #interact-prompt {
            position: absolute;
            top: -40px;
            background: white;
            color: black;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: none;
            white-space: nowrap;
        }

        /* MODAL DE DESAFIO (QUIZ) */
        #quiz-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #0f172a;
            padding: 30px;
            border-radius: 20px;
            border: 2px solid #38bdf8;
            width: 90%;
            max-width: 400px;
            display: none;
            z-index: 100;
            text-align: center;
        }

        .btn-opcao {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #334155;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .btn-opcao:hover { background: #475569; }

        /* CONTROLES MOBILE */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
        }
        .btn-move {
            width: 60px;
            height: 60px;
            background: #334155;
            border: none;
            color: white;
            border-radius: 10px;
            font-size: 20px;
        }

        header { padding: 15px; background: #0f172a; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

    <header>
        <div><strong>ArenaFisio</strong> - Modo RPG</div>
        <a href="painel.html" style="color: #94a3b8; text-decoration: none;">Sair da Arena</a>
    </header>

    <div id="game-container">
        <div id="player">üë®‚Äç‚öïÔ∏è</div>

        <div id="patient">
            ü§ï
            <div id="interact-prompt">Pressione ESPA√áO para tratar</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-move" onclick="move('up')">‚ñ≤</button>
        <div style="display: flex; gap: 40px;">
            <button class="btn-move" onclick="move('left')">‚óÄ</button>
            <button class="btn-move" onclick="move('right')">‚ñ∂</button>
        </div>
        <button class="btn-move" onclick="move('down')">‚ñº</button>
    </div>

    <div id="quiz-modal">
        <h3 id="titulo-caso">Atendimento Cl√≠nico</h3>
        <p id="pergunta">O paciente apresenta dor aguda no ombro ap√≥s queda. Qual o primeiro passo?</p>
        <button class="btn-opcao" onclick="responder(true)">A) Avalia√ß√£o de amplitude de movimento</button>
        <button class="btn-opcao" onclick="responder(false)">B) Aplicar gelo e liberar o paciente</button>
        <p id="feedback" style="margin-top: 15px; font-weight: bold;"></p>
    </div>

    <script src="js/app.js"></script>

    <script>
        // L√≥gica de Movimento
        let pX = 50;
        let pY = 50;
        const speed = 25;
        const player = document.getElementById('player');
        const patient = document.getElementById('patient');
        const prompt = document.getElementById('interact-prompt');
        const modal = document.getElementById('quiz-modal');

        function updatePosition() {
            player.style.left = pX + 'px';
            player.style.top = pY + 'px';
            checkCollision();
        }

        function move(dir) {
            if (modal.style.display === 'block') return; // Trava o boneco se estiver no quiz

            if (dir === 'up') pY -= speed;
            if (dir === 'down') pY += speed;
            if (dir === 'left') pX -= speed;
            if (dir === 'right') pX += speed;
            
            // Limites da tela
            if (pX < 0) pX = 0;
            if (pY < 0) pY = 0;

            updatePosition();
        }

        // Teclado
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp' || e.key === 'w') move('up');
            if (e.key === 'ArrowDown' || e.key === 's') move('down');
            if (e.key === 'ArrowLeft' || e.key === 'a') move('left');
            if (e.key === 'ArrowRight' || e.key === 'd') move('right');
            if (e.key === ' ' && prompt.style.display === 'block') {
                abrirQuiz();
            }
        });

        function checkCollision() {
            const dist = Math.sqrt(Math.pow(pX - 500, 2) + Math.pow(pY - 200, 2));
            if (dist < 60) {
                prompt.style.display = 'block';
            } else {
                prompt.style.display = 'none';
            }
        }

        function abrirQuiz() {
            modal.style.display = 'block';
        }

        function responder(correta) {
            const feedback = document.getElementById('feedback');
            if (correta) {
                feedback.innerHTML = "‚úÖ Excelente! +100 XP";
                feedback.style.color = "#10b981";
                setTimeout(() => {
                    if (typeof concluirDesafio === "function") {
                        concluirDesafio(100); 
                    } else {
                        alert("Desafio Conclu√≠do! +100 XP");
                        window.location.href = "painel.html";
                    }
                }, 1500);
            } else {
                feedback.innerHTML = "‚ùå Tente novamente!";
                feedback.style.color = "#ef4444";
            }
        }

        updatePosition();
    </script>
</body>
</html>
